

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Transactions &#8212; The DataJoint Course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/DesignPatterns';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../root.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/neuron.png" class="logo__image only-light" alt="The DataJoint Course - Home"/>
    <script>document.write(`<img src="../_static/neuron.png" class="logo__image only-dark" alt="The DataJoint Course - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../root.html">
                    The DataJoint Course
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Database Design</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../design/relational.html">The Relational Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/normalization.html">Database normalization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Jupyter Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../note.html">Content with notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/DesignPatterns.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/DesignPatterns.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Transactions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Transactions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design-patterns">Design Patterns</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sequence-workflows">Sequence / Workflows</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#two-ways-to-model-hierarchies">Two ways to model hierarchies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approach-1-simple-primary-keys-with-secondary-dependencies">Approach 1: Simple primary keys with secondary dependencies</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#parameterization">Parameterization</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#association">Association</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#generalization-specialization">Generalization / specialization</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#directed-graphs">Directed graphs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#undirected-graphs">Undirected graphs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#puzzle">Puzzle:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#in-sql">In SQL</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">In SQL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem">Problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework-homework">Homework homework</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#messaging-app-slack-telegram-signal">Messaging App (Slack, Telegram, Signal)</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cred.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">connection_string</span> <span class="o">=</span> <span class="s2">&quot;mysql://</span><span class="si">{user}</span><span class="s2">:</span><span class="si">{password}</span><span class="s2">@</span><span class="si">{host}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">creds</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pymysql</span> 
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cred.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">creds</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">connection_string</span> <span class="o">=</span> <span class="s2">&quot;mysql://</span><span class="si">{user}</span><span class="s2">:</span><span class="si">{password}</span><span class="s2">@</span><span class="si">{host}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">creds</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;cred.json&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">config</span> SqlMagic.autocommit=True
<span class="o">%</span><span class="k">sql</span> $connection_string
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="transactions">
<h1>Transactions<a class="headerlink" href="#transactions" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>A = Atomic</p></li>
<li><p>C = Consistent</p></li>
<li><p>I = Isolated</p></li>
<li><p>D = Durable</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="s1">&#39;dimitri_bank&#39;</span><span class="p">)</span>
<span class="n">schema</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="s1">&#39;dimitri_bank&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2022-11-08 11:21:52,567][INFO]: Connecting dimitri@db.ust-data-sci.net:3306
[2022-11-08 11:21:53,609][INFO]: Connected dimitri@db.ust-data-sci.net:3306
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proceed to delete entire schema `dimitri_bank`? [yes, No]: yes
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    account_number : int</span>
<span class="s2">    ---</span>
<span class="s2">    customer_name : varchar(60) </span>
<span class="s2">    balance : decimal(9, 2)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Account</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
    <span class="nb">dict</span><span class="p">(</span>
        <span class="n">account_number</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">99_999_999</span><span class="p">),</span>
        <span class="n">customer_name</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
        <span class="n">balance</span><span class="o">=</span><span class="n">fake</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100_000_00</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Account</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">account_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">customer_name</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">balance</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>12050569</td>
<td>Shannon Santos</td>
<td>6679.10</td></tr><tr><td>12585078</td>
<td>Elizabeth Sherman</td>
<td>81401.22</td></tr><tr><td>12922010</td>
<td>Gary Cummings</td>
<td>82458.58</td></tr><tr><td>14429509</td>
<td>Lisa Garcia</td>
<td>62684.81</td></tr><tr><td>16865880</td>
<td>Christy Jones</td>
<td>36643.26</td></tr><tr><td>16891629</td>
<td>Alfred Potter</td>
<td>25586.46</td></tr><tr><td>17183102</td>
<td>Chad Nguyen Jr.</td>
<td>8421.74</td></tr><tr><td>18025005</td>
<td>Andrew Wilson</td>
<td>50134.35</td></tr><tr><td>18104044</td>
<td>Jody Collins</td>
<td>43370.19</td></tr><tr><td>18369903</td>
<td>Ronald Stokes</td>
<td>72475.77</td></tr><tr><td>20536886</td>
<td>Elizabeth Murphy</td>
<td>26302.92</td></tr><tr><td>21122881</td>
<td>John Mcdonald</td>
<td>66577.76</td> </tr> </tbody>
        </table>
        <p>...</p>
        <p>Total: 100</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;KEY&#39;</span><span class="p">)</span>
<span class="n">account1</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="n">account2</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;account_number&#39;: 71167941}, {&#39;account_number&#39;: 45255856})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
    
    <span class="k">with</span> <span class="n">Account</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">transaction</span><span class="p">:</span>

        <span class="n">current_balance</span> <span class="o">=</span> <span class="p">(</span><span class="n">Account</span> <span class="o">&amp;</span> <span class="n">account1</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;balance&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_balance</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">)</span>

        <span class="n">Account</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">current_balance</span><span class="p">)</span> <span class="o">-</span> <span class="n">amount</span><span class="p">))</span>

        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Account</span> <span class="o">&amp;</span> <span class="n">account2</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;balance&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="kc">False</span>
        
        <span class="n">Account</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">account2</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Account</span> <span class="o">&amp;</span> <span class="p">[</span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">account_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">customer_name</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">balance</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>45255856</td>
<td>Chad Atkins</td>
<td>3900.08</td></tr><tr><td>71167941</td>
<td>Cody Morgan</td>
<td>21836.97</td> </tr> </tbody>
        </table>
        
        <p>Total: 2</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transfer</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">Input In [13],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">transfer</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">)</span>

<span class="nn">Input In [11],</span> in <span class="ni">transfer</span><span class="nt">(account1, account2, amount)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">Account</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">current_balance</span><span class="p">)</span> <span class="o">-</span> <span class="n">amount</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Account</span> <span class="o">&amp;</span> <span class="n">account2</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s1">&#39;balance&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">12</span> <span class="k">assert</span> <span class="kc">False</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">Account</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">account2</span><span class="p">,</span> <span class="n">balance</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount</span><span class="p">))</span>

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Account</span> <span class="o">&amp;</span> <span class="p">[</span><span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">account_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">customer_name</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">balance</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>45255856</td>
<td>Chad Atkins</td>
<td>3900.08</td></tr><tr><td>71167941</td>
<td>Cody Morgan</td>
<td>21836.97</td> </tr> </tbody>
        </table>
        
        <p>Total: 2</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

use dimitri_bank;

SHOW CREATE TABLE account;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * mysql://dimitri:***@db.ust-data-sci.net
0 rows affected.
1 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Table</th>
        <th>Create Table</th>
    </tr>
    <tr>
        <td>account</td>
        <td>CREATE TABLE `account` (<br>  `account_number` int(11) NOT NULL,<br>  `customer_name` varchar(60) NOT NULL,<br>  `balance` decimal(9,2) NOT NULL,<br>  PRIMARY KEY (`account_number`)<br>) ENGINE=InnoDB DEFAULT CHARSET=latin1</td>
    </tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT * FROM account;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * mysql://dimitri:***@db.ust-data-sci.net
100 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>account_number</th>
        <th>customer_name</th>
        <th>balance</th>
    </tr>
    <tr>
        <td>12050569</td>
        <td>Shannon Santos</td>
        <td>6679.10</td>
    </tr>
    <tr>
        <td>12585078</td>
        <td>Elizabeth Sherman</td>
        <td>81401.22</td>
    </tr>
    <tr>
        <td>12922010</td>
        <td>Gary Cummings</td>
        <td>82458.58</td>
    </tr>
    <tr>
        <td>14429509</td>
        <td>Lisa Garcia</td>
        <td>62684.81</td>
    </tr>
    <tr>
        <td>16865880</td>
        <td>Christy Jones</td>
        <td>36643.26</td>
    </tr>
    <tr>
        <td>16891629</td>
        <td>Alfred Potter</td>
        <td>25586.46</td>
    </tr>
    <tr>
        <td>17183102</td>
        <td>Chad Nguyen Jr.</td>
        <td>8421.74</td>
    </tr>
    <tr>
        <td>18025005</td>
        <td>Andrew Wilson</td>
        <td>50134.35</td>
    </tr>
    <tr>
        <td>18104044</td>
        <td>Jody Collins</td>
        <td>43370.19</td>
    </tr>
    <tr>
        <td>18369903</td>
        <td>Ronald Stokes</td>
        <td>72475.77</td>
    </tr>
    <tr>
        <td>20536886</td>
        <td>Elizabeth Murphy</td>
        <td>26302.92</td>
    </tr>
    <tr>
        <td>21122881</td>
        <td>John Mcdonald</td>
        <td>66577.76</td>
    </tr>
    <tr>
        <td>22346493</td>
        <td>Angela Cook</td>
        <td>8726.90</td>
    </tr>
    <tr>
        <td>23580748</td>
        <td>Phillip Phillips</td>
        <td>87117.86</td>
    </tr>
    <tr>
        <td>24304691</td>
        <td>Gary Davis</td>
        <td>61267.87</td>
    </tr>
    <tr>
        <td>29585828</td>
        <td>Sheila Mack</td>
        <td>3143.64</td>
    </tr>
    <tr>
        <td>31867228</td>
        <td>Matthew Jensen Jr.</td>
        <td>10613.30</td>
    </tr>
    <tr>
        <td>32398369</td>
        <td>Kathryn Bush</td>
        <td>86954.62</td>
    </tr>
    <tr>
        <td>32491608</td>
        <td>Christina Peterson</td>
        <td>96449.55</td>
    </tr>
    <tr>
        <td>32606812</td>
        <td>Shannon Melton</td>
        <td>56821.76</td>
    </tr>
    <tr>
        <td>32800520</td>
        <td>Desiree White</td>
        <td>5503.59</td>
    </tr>
    <tr>
        <td>35601316</td>
        <td>Brittney Wright DDS</td>
        <td>85239.41</td>
    </tr>
    <tr>
        <td>36448533</td>
        <td>Charles Rivers</td>
        <td>28255.00</td>
    </tr>
    <tr>
        <td>37607221</td>
        <td>Joseph Rojas</td>
        <td>67438.57</td>
    </tr>
    <tr>
        <td>38275461</td>
        <td>Jessica Cervantes</td>
        <td>12397.28</td>
    </tr>
    <tr>
        <td>38310940</td>
        <td>Bryan Mcmahon</td>
        <td>31183.65</td>
    </tr>
    <tr>
        <td>38476377</td>
        <td>Kathleen Horton</td>
        <td>24121.70</td>
    </tr>
    <tr>
        <td>41136819</td>
        <td>Mario Anderson</td>
        <td>69689.05</td>
    </tr>
    <tr>
        <td>41353087</td>
        <td>Amber Wallace</td>
        <td>55862.85</td>
    </tr>
    <tr>
        <td>42185083</td>
        <td>Gina Murillo</td>
        <td>47656.73</td>
    </tr>
    <tr>
        <td>42576215</td>
        <td>Mary Barnes</td>
        <td>82977.61</td>
    </tr>
    <tr>
        <td>43023148</td>
        <td>Benjamin Richardson</td>
        <td>19640.96</td>
    </tr>
    <tr>
        <td>43256866</td>
        <td>Dawn Price</td>
        <td>27384.32</td>
    </tr>
    <tr>
        <td>43704100</td>
        <td>Sara Weaver</td>
        <td>64056.63</td>
    </tr>
    <tr>
        <td>43712744</td>
        <td>Cynthia Willis</td>
        <td>71119.29</td>
    </tr>
    <tr>
        <td>44244863</td>
        <td>Joseph Perez</td>
        <td>34877.09</td>
    </tr>
    <tr>
        <td>44436274</td>
        <td>Amber Fitzpatrick</td>
        <td>58606.29</td>
    </tr>
    <tr>
        <td>45255856</td>
        <td>Chad Atkins</td>
        <td>3900.08</td>
    </tr>
    <tr>
        <td>45277679</td>
        <td>Aaron Barnes</td>
        <td>42783.60</td>
    </tr>
    <tr>
        <td>45812721</td>
        <td>Tim Carter</td>
        <td>4561.58</td>
    </tr>
    <tr>
        <td>46013960</td>
        <td>Zachary Sherman</td>
        <td>97940.03</td>
    </tr>
    <tr>
        <td>49643932</td>
        <td>Scott Davis</td>
        <td>46175.00</td>
    </tr>
    <tr>
        <td>50312738</td>
        <td>Victoria Andrews</td>
        <td>72410.91</td>
    </tr>
    <tr>
        <td>50354017</td>
        <td>Melissa Hobbs</td>
        <td>12830.85</td>
    </tr>
    <tr>
        <td>51674129</td>
        <td>Laura Huber</td>
        <td>15506.18</td>
    </tr>
    <tr>
        <td>52662843</td>
        <td>Donna Smith</td>
        <td>96704.53</td>
    </tr>
    <tr>
        <td>52926354</td>
        <td>Kerri Elliott</td>
        <td>94942.99</td>
    </tr>
    <tr>
        <td>54714079</td>
        <td>Michael Jones</td>
        <td>47161.03</td>
    </tr>
    <tr>
        <td>55439872</td>
        <td>Annette Cuevas</td>
        <td>64012.92</td>
    </tr>
    <tr>
        <td>56541462</td>
        <td>Haley Wilson</td>
        <td>8815.40</td>
    </tr>
    <tr>
        <td>57064339</td>
        <td>Theresa Snyder</td>
        <td>20683.21</td>
    </tr>
    <tr>
        <td>57935558</td>
        <td>Daniel Armstrong</td>
        <td>18834.38</td>
    </tr>
    <tr>
        <td>58000819</td>
        <td>Jamie Dixon</td>
        <td>34711.82</td>
    </tr>
    <tr>
        <td>58545212</td>
        <td>Linda Jones</td>
        <td>2458.01</td>
    </tr>
    <tr>
        <td>59841226</td>
        <td>Jennifer Williams</td>
        <td>79297.52</td>
    </tr>
    <tr>
        <td>61068175</td>
        <td>Bryan Green</td>
        <td>73076.54</td>
    </tr>
    <tr>
        <td>61825741</td>
        <td>Jessica Robinson</td>
        <td>90067.20</td>
    </tr>
    <tr>
        <td>62723410</td>
        <td>Christine Turner</td>
        <td>32029.44</td>
    </tr>
    <tr>
        <td>63634081</td>
        <td>Daniel Contreras</td>
        <td>87923.71</td>
    </tr>
    <tr>
        <td>64538767</td>
        <td>Melissa Turner</td>
        <td>59850.53</td>
    </tr>
    <tr>
        <td>65644872</td>
        <td>James Avila</td>
        <td>68329.73</td>
    </tr>
    <tr>
        <td>69386626</td>
        <td>Kelsey Cervantes</td>
        <td>79170.79</td>
    </tr>
    <tr>
        <td>69610798</td>
        <td>Brandi Moore</td>
        <td>11125.43</td>
    </tr>
    <tr>
        <td>70167668</td>
        <td>Brian Hoover</td>
        <td>85543.93</td>
    </tr>
    <tr>
        <td>71167941</td>
        <td>Cody Morgan</td>
        <td>21836.97</td>
    </tr>
    <tr>
        <td>72203243</td>
        <td>Carrie Thomas</td>
        <td>76766.21</td>
    </tr>
    <tr>
        <td>72987179</td>
        <td>Dana Baker</td>
        <td>96049.74</td>
    </tr>
    <tr>
        <td>73492317</td>
        <td>Adrienne Stone</td>
        <td>45186.78</td>
    </tr>
    <tr>
        <td>74290373</td>
        <td>William Douglas</td>
        <td>65616.71</td>
    </tr>
    <tr>
        <td>74704243</td>
        <td>Barbara Cuevas</td>
        <td>10731.71</td>
    </tr>
    <tr>
        <td>75147177</td>
        <td>Jocelyn Gilbert</td>
        <td>23482.65</td>
    </tr>
    <tr>
        <td>75189013</td>
        <td>Lori Jones</td>
        <td>60922.02</td>
    </tr>
    <tr>
        <td>75353895</td>
        <td>Paul Benson</td>
        <td>26102.18</td>
    </tr>
    <tr>
        <td>75360790</td>
        <td>Blake Cooper</td>
        <td>16122.13</td>
    </tr>
    <tr>
        <td>75523120</td>
        <td>Paul Gibson</td>
        <td>81543.97</td>
    </tr>
    <tr>
        <td>75863409</td>
        <td>James Hines</td>
        <td>75250.71</td>
    </tr>
    <tr>
        <td>76936237</td>
        <td>Chad Nicholson</td>
        <td>98420.50</td>
    </tr>
    <tr>
        <td>77149605</td>
        <td>Jonathan Bautista</td>
        <td>95316.22</td>
    </tr>
    <tr>
        <td>77401497</td>
        <td>Elizabeth Andersen</td>
        <td>88391.06</td>
    </tr>
    <tr>
        <td>79438170</td>
        <td>Ms. Rebecca Hall</td>
        <td>60703.58</td>
    </tr>
    <tr>
        <td>79475809</td>
        <td>Bryan Brown Jr.</td>
        <td>59410.50</td>
    </tr>
    <tr>
        <td>79504929</td>
        <td>Megan Carlson</td>
        <td>48345.86</td>
    </tr>
    <tr>
        <td>80342292</td>
        <td>Rodney Strickland</td>
        <td>11927.42</td>
    </tr>
    <tr>
        <td>80728264</td>
        <td>Reginald Roberts</td>
        <td>78922.39</td>
    </tr>
    <tr>
        <td>82425155</td>
        <td>David Clark</td>
        <td>17295.15</td>
    </tr>
    <tr>
        <td>84847035</td>
        <td>Timothy Williams</td>
        <td>35919.15</td>
    </tr>
    <tr>
        <td>85232444</td>
        <td>Ashley Knight</td>
        <td>58513.22</td>
    </tr>
    <tr>
        <td>86646935</td>
        <td>Judith Rodriguez</td>
        <td>82176.38</td>
    </tr>
    <tr>
        <td>87356185</td>
        <td>Laura Castillo</td>
        <td>81767.62</td>
    </tr>
    <tr>
        <td>87591115</td>
        <td>Eric Fields</td>
        <td>49400.63</td>
    </tr>
    <tr>
        <td>89363591</td>
        <td>Sara Griffith</td>
        <td>27862.81</td>
    </tr>
    <tr>
        <td>90446123</td>
        <td>James Gibson</td>
        <td>58628.37</td>
    </tr>
    <tr>
        <td>91973536</td>
        <td>Karen Hunt</td>
        <td>91278.72</td>
    </tr>
    <tr>
        <td>94335018</td>
        <td>Eric Mcgee</td>
        <td>97024.05</td>
    </tr>
    <tr>
        <td>95440048</td>
        <td>Angela Roman</td>
        <td>75554.23</td>
    </tr>
    <tr>
        <td>97181338</td>
        <td>Joseph Matthews</td>
        <td>23464.91</td>
    </tr>
    <tr>
        <td>97328507</td>
        <td>Julie Baker</td>
        <td>86320.40</td>
    </tr>
    <tr>
        <td>98197568</td>
        <td>Mr. Dylan Hernandez</td>
        <td>67592.91</td>
    </tr>
    <tr>
        <td>98230343</td>
        <td>Nicholas Jacobson</td>
        <td>44952.48</td>
    </tr>
    <tr>
        <td>99345844</td>
        <td>Caleb Davis</td>
        <td>40633.29</td>
    </tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

BEGIN TRANSACTION;
  
    UPDATE account SET balance = balance + 100
    WHERE account = 98230343;
    
    
    UPDATE account SET balance = balance - 100
    WHERE account 95440048;

COMMIT
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * mysql://dimitri:***@db.ust-data-sci.net
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">Exception</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [18],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_cell_magic</span><span class="p">(</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">BEGIN TRANSACTION;</span><span class="se">\n</span><span class="s1">  </span><span class="se">\n</span><span class="s1">    UPDATE account SET balance = balance + 100</span><span class="se">\n</span><span class="s1">    WHERE account = 98230343;</span><span class="se">\n</span><span class="s1">    </span><span class="se">\n</span><span class="s1">    </span><span class="se">\n</span><span class="s1">    UPDATE account SET balance = balance - 100</span><span class="se">\n</span><span class="s1">    WHERE account 95440048;</span><span class="se">\n\n</span><span class="s1">COMMIT</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/IPython/core/interactiveshell.py:2358,</span> in <span class="ni">InteractiveShell.run_cell_magic</span><span class="nt">(self, magic_name, line, cell)</span>
<span class="g g-Whitespace">   </span><span class="mi">2356</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2357</span>     <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">magic_arg_s</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2358</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2359</span> <span class="k">return</span> <span class="n">result</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/sql/magic.py:215,</span> in <span class="ni">SqlMagic.execute</span><span class="nt">(self, line, cell, local_ns)</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span>     <span class="k">return</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">215</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">,</span> <span class="n">user_ns</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span>     <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span>         <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span>         <span class="c1"># Instead of returning values, set variables directly in the</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span>         <span class="c1"># users namespace. Variable names given by column names</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autopandas</span><span class="p">:</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/sql/run.py:357,</span> in <span class="ni">run</span><span class="nt">(conn, sql, config, user_namespace)</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span> <span class="n">first_word</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span> <span class="k">if</span> <span class="n">first_word</span> <span class="o">==</span> <span class="s2">&quot;begin&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">357</span>     <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ipython_sql does not support transactions&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span> <span class="k">if</span> <span class="n">first_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">and</span> \
<span class="g g-Whitespace">    </span><span class="mi">359</span>         <span class="p">(</span><span class="s2">&quot;postgres&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">dialect</span><span class="p">)</span> <span class="ow">or</span> \
<span class="g g-Whitespace">    </span><span class="mi">360</span>         <span class="s2">&quot;redshift&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">dialect</span><span class="p">)):</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">PGSpecial</span><span class="p">:</span>

<span class="ne">Exception</span>: ipython_sql does not support transactions
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cred.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">creds</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">creds</span><span class="p">,</span> <span class="n">autocommit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">account1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;account_number&#39;: 71167941}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT balance FROM dimitri_bank.account </span>
<span class="s2">    WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">account1</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>

<span class="n">amount</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">current_balance</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    UPDATE dimitri_bank.account </span>
<span class="s2">    SET balance = balance - </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">account1</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    UPDATE dimitri_bank.account </span>
<span class="s2">    SET balance = balance + </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">account2</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">account1</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
    
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;BEGIN TRANSACTION&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT balance FROM shared_bank.account </span>
<span class="s2">            WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">account1</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>

        <span class="n">current_balance</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">current_balance</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Insufficient funds&#39;</span><span class="p">)</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            UPDATE shared_bank.account </span>
<span class="s2">            SET balance = balance - </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">account1</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            UPDATE shared_bank.account </span>
<span class="s2">            SET balance = balance + </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            WHERE account_number = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">account2</span><span class="p">[</span><span class="s2">&quot;account_number&quot;</span><span class="p">],))</span>
        
    <span class="k">except</span><span class="p">:</span> 
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;CANCEL TRANSACTION&#39;</span><span class="p">)</span>
        <span class="k">raise</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;COMMIT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="design-patterns">
<h1>Design Patterns<a class="headerlink" href="#design-patterns" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Sequence</p>
<ul>
<li><p>workflows</p></li>
</ul>
</li>
<li><p>Specialization / Generalization</p>
<ul>
<li><p>student / faculty / staff</p></li>
</ul>
</li>
<li><p>Hierarchies</p>
<ul>
<li><p>Ownership</p></li>
<li><p>Using composite primary keys</p></li>
<li><p>Secondary keys</p></li>
</ul>
</li>
<li><p>Parameterization
*</p></li>
<li><p>Associations</p>
<ul>
<li><p>Many-to-many relationships</p></li>
<li><p>Directed graphs</p></li>
<li><p>Trees</p></li>
<li><p>Undirected graphs</p></li>
</ul>
</li>
<li><p>Master-part</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;dimitri_patterns&#39;</span><span class="p">)</span>
<span class="n">schema</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="s1">&#39;dimitri_patterns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proceed to delete entire schema `dimitri_patterns`? [yes, No]: yes
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="sequence-workflows">
<h1>Sequence / Workflows<a class="headerlink" href="#sequence-workflows" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># E.g. order / shipment / confirmation</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    order_number : int</span>
<span class="s2">    ---</span>
<span class="s2">    order_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Shipment</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Order</span>
<span class="s2">    ---</span>
<span class="s2">    ship_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Confirm</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Shipment</span>
<span class="s2">    ---</span>
<span class="s2">    confirm_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/11b9bee20e890fe2bb1747a0e12809691e1da6bf8e8acd4babc4e61c8dfbb228.svg" src="../_images/11b9bee20e890fe2bb1747a0e12809691e1da6bf8e8acd4babc4e61c8dfbb228.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Order</span> <span class="o">*</span> <span class="n">Shipment</span> <span class="o">*</span> <span class="n">Confirm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">order_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">order_date</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">ship_date</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">confirm_date</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Order2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    order_number : int</span>
<span class="s2">    ---</span>
<span class="s2">    order_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Shipment2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    shipment_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt;[unique] Order2</span>
<span class="s2">    ship_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Confirm2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    confirm_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; [unique] Shipment2</span>
<span class="s2">    confirm_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6e49bfdad106102922b23b74624d72d7902e5d71a31e3d9369b39395a1f51922.svg" src="../_images/6e49bfdad106102922b23b74624d72d7902e5d71a31e3d9369b39395a1f51922.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Order</span> <span class="o">*</span> <span class="n">Confirm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">order_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">order_date</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">confirm_date</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Order</span> <span class="o">*</span> <span class="n">Shipment</span> <span class="o">*</span> <span class="n">Confirm</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">order_number</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">order_date</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">ship_date</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">confirm_date</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="two-ways-to-model-hierarchies">
<h1>Two ways to model hierarchies<a class="headerlink" href="#two-ways-to-model-hierarchies" title="Permalink to this heading">#</a></h1>
<section id="approach-1-simple-primary-keys-with-secondary-dependencies">
<h2>Approach 1: Simple primary keys with secondary dependencies<a class="headerlink" href="#approach-1-simple-primary-keys-with-secondary-dependencies" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Subject</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Experiment Subject</span>
<span class="s2">    subject_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    species = &#39;mouse&#39; : enum(&#39;human&#39;, &#39;mouse&#39;, &#39;rat&#39;, &#39;worm&#39;)</span>
<span class="s2">    sex : enum(&#39;F&#39;, &#39;M&#39;, &#39;unknown&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Subject</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b>Experiment Subject</b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">subject_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">species</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">sex</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Subject</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">subject_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Subject</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">subject_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Subject</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">subject_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="s2">&quot;worm&quot;</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Subject</span>
<span class="s2">    session : int</span>
<span class="s2">    ---</span>
<span class="s2">    session_timestamp = CURRENT_TIMESTAMP : timestamp</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">subject_id</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Session</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">subject_id</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Session</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subject_id</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">subject_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">session</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">session_timestamp</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>2</td>
<td>1</td>
<td>2022-11-08 17:24:53</td></tr><tr><td>2</td>
<td>2</td>
<td>2022-11-08 17:24:53</td></tr><tr><td>3</td>
<td>3</td>
<td>2022-11-08 17:24:53</td> </tr> </tbody>
        </table>
        
        <p>Total: 3</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Scan</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Session</span>
<span class="s2">    scan_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    laser_power : float  # mW</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Scan</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">subject_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">session</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">scan_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">laser_power</p>
                            <span class="djtooltiptext">mW</span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Scan</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">subject_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scan_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">laser_power</span><span class="o">=</span><span class="mi">3200</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Scan</span>
<span class="s2">    cell_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    cell_type : enum(&#39;E&#39;, &#39;I&#39;)   # excitatory or inhibitory</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/561a028c928028f7f3cb49667a917282cb3c08e924b08d29fa4864130e014037.svg" src="../_images/561a028c928028f7f3cb49667a917282cb3c08e924b08d29fa4864130e014037.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Give me excitatory cells for all males</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cell</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Subject</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s2">&quot;M&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">subject_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">session</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">scan_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">cell_id</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">cell_type</p>
                            <span class="djtooltiptext">excitatory or inhibitory</span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Subject2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Experiment Subject</span>
<span class="s2">    subject_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    species = &#39;mouse&#39; : enum(&#39;human&#39;, &#39;mouse&#39;, &#39;rat&#39;, &#39;worm&#39;)</span>
<span class="s2">    sex : enum(&#39;F&#39;, &#39;M&#39;, &#39;unknown&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Session2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    session : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Subject2</span>
<span class="s2">    session_timestamp = CURRENT_TIMESTAMP : timestamp</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Scan2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    scan_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Session2</span>
<span class="s2">    laser_power : float  # mW</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Cell2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    cell_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Scan2</span>
<span class="s2">    cell_type : enum(&#39;E&#39;, &#39;I&#39;)   # excitatory or inhibitory</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/173e99903bdbe8cc37c38c722dd36779460293594c4ba50c66efd32090347414.svg" src="../_images/173e99903bdbe8cc37c38c722dd36779460293594c4ba50c66efd32090347414.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cell</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cell_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scan_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MissingAttributeError</span><span class="g g-Whitespace">                     </span>Traceback (most recent call last)
<span class="nn">Input In [53],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Cell</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">cell_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scan_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;E&quot;</span><span class="p">))</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/table.py:334,</span> in <span class="ni">Table.insert1</span><span class="nt">(self, row, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> <span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span><span class="sd">     Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">331</span><span class="sd">     :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span><span class="sd">         as one row.</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">334</span>     <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/table.py:430,</span> in <span class="ni">Table.insert</span><span class="nt">(self, rows, replace, skip_duplicates, ignore_extra_fields, allow_direct_insert)</span>
<span class="g g-Whitespace">    </span><span class="mi">414</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">415</span>     <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{destination}</span><span class="s2">(`</span><span class="si">{fields}</span><span class="s2">`) VALUES </span><span class="si">{placeholders}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">416</span>         <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span>         <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">428</span>         <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">429</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">430</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">431</span>         <span class="n">query</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">432</span>         <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">433</span>             <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">434</span>                 <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span>
<span class="g g-Whitespace">    </span><span class="mi">435</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">436</span>         <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">437</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">438</span> <span class="k">except</span> <span class="n">UnknownAttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span>     <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">440</span>         <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">441</span>     <span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/connection.py:340,</span> in <span class="ni">Connection.query</span><span class="nt">(self, query, args, as_dict, suppress_warnings, reconnect)</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">339</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">340</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span> <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">reconnect</span><span class="p">:</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/connection.py:296,</span> in <span class="ni">Connection._execute_query</span><span class="nt">(cursor, query, args, suppress_warnings)</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span>         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">295</span> <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">296</span>     <span class="k">raise</span> <span class="n">translate_query_error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

<span class="ne">MissingAttributeError</span>: Field &#39;subject_id&#39; doesn&#39;t have a default value
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cell</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Give me cells for subject_id=1</span>

<span class="n">Cell2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Scan2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Session2</span> <span class="o">&amp;</span> <span class="s1">&#39;subject_id=2&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Give me cells for all males</span>

<span class="p">(</span><span class="n">Cell2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Scan2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Session2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Subject2</span> <span class="o">&amp;</span> <span class="s1">&#39;sex=&quot;M&quot;&#39;</span><span class="p">))))</span><span class="o">.</span><span class="n">make_sql</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">Cell</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Subject</span> <span class="o">&amp;</span> <span class="s1">&#39;sex=&quot;M&quot;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">make_sql</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="parameterization">
<h1>Parameterization<a class="headerlink" href="#parameterization" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    image_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    image : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">EnhanceMethod</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Lookup</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    enhance_method : int</span>
<span class="s2">    ---</span>
<span class="s2">    method_name : varchar(16)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="n">contents</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sharpen&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">EnhancedImage</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Image</span>
<span class="s2">    -&gt; EnhanceMethod</span>
<span class="s2">    ---</span>
<span class="s2">    enhanced_image : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="association">
<h1>Association<a class="headerlink" href="#association" title="Permalink to this heading">#</a></h1>
<p>Books and authors</p>
<p>Checking accounts and account owners</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    isbn : int</span>
<span class="s2">    ---</span>
<span class="s2">    title : varchar(300)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    author_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    name : varchar(300)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">AuthorBook</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Author</span>
<span class="s2">    -&gt; Book</span>
<span class="s2">    ---</span>
<span class="s2">    order : tinyint unsigned </span>
<span class="s2">    unique index(isbn, order)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a2491dfaffffc88e5feb6c31df763618438057664028a7576d0b388d7b00d670.svg" src="../_images/a2491dfaffffc88e5feb6c31df763618438057664028a7576d0b388d7b00d670.svg" /></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="generalization-specialization">
<h1>Generalization / specialization<a class="headerlink" href="#generalization-specialization" title="Permalink to this heading">#</a></h1>
<p>Employee, student, instructor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    person_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    date_of_birth : date</span>
<span class="s2">    gender : enum(&quot;male&quot;, &quot;female&quot;, &quot;unknown&quot;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Person</span>
<span class="s2">    ---</span>
<span class="s2">    hire_date : date    </span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Instructor</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Employee</span>
<span class="s2">    ---</span>
<span class="s2">    department : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Person</span>
<span class="s2">    ---</span>
<span class="s2">    admission_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/859ec246afa7f7453847cb09df00de3f70fb83c1835779bd66efae057e3352bb.svg" src="../_images/859ec246afa7f7453847cb09df00de3f70fb83c1835779bd66efae057e3352bb.svg" /></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="directed-graphs">
<h1>Directed graphs<a class="headerlink" href="#directed-graphs" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Subordinate</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Employee</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Employee.proj(manager_id=&quot;person_id&quot;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f758603238ecd55bd69c9f66d9063987eccd1640da76edd069f90aa805f64169.svg" src="../_images/f758603238ecd55bd69c9f66d9063987eccd1640da76edd069f90aa805f64169.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Neuron</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    neuron : int</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Synapse</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    synapse_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Neuron.proj(pre=&quot;neuron&quot;)</span>
<span class="s2">    -&gt; Neuron.proj(post=&quot;neuron&quot;)    </span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02b204ce9d866b247d35d8f738ce416c9d6ff4f91d823f53fd03ea230e563336.svg" src="../_images/02b204ce9d866b247d35d8f738ce416c9d6ff4f91d823f53fd03ea230e563336.svg" /></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">managed_by</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="n">person_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">manager_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span>
<span class="w">   </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">person_id</span><span class="p">),</span><span class="w"></span>
<span class="w">   </span>
<span class="w">   </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="p">(</span><span class="n">person_id</span><span class="p">),</span><span class="w"></span>
<span class="w">   </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">manager_id</span><span class="p">)</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="p">(</span><span class="n">person_id</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="undirected-graphs">
<h1>Undirected graphs<a class="headerlink" href="#undirected-graphs" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># direcated friendship = full directed graph capability</span>
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Friendship</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Person.proj(friend1 = &quot;person_id&quot;)</span>
<span class="s2">    -&gt; Person.proj(friend2 = &quot;person_id&quot;)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/80d8c69adf04d076d1d4a078bc9a4092d1fd994fb78648c71f2a49ff5081d929.svg" src="../_images/80d8c69adf04d076d1d4a078bc9a4092d1fd994fb78648c71f2a49ff5081d929.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    order_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    order_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; master</span>
<span class="s2">        order_item : int</span>
<span class="s2">        ---</span>
<span class="s2">        </span>
<span class="s2">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="puzzle">
<h1>Puzzle:<a class="headerlink" href="#puzzle" title="Permalink to this heading">#</a></h1>
<p>Cities and states.</p>
<ol class="arabic simple">
<li><p>Each city belongs to one state.</p></li>
<li><p>Each state has one capital.</p></li>
<li><p>A capital is a city.</p></li>
<li><p>A capital must be in the same state.</p></li>
</ol>
<ul class="simple">
<li><p>Tables</p></li>
<li><p>Primary keys</p></li>
<li><p>Foreign keys</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    st : char(2)</span>
<span class="s2">    ---</span>
<span class="s2">    state : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="n">State</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span>
    <span class="p">(</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Washington&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Texas&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;AK&quot;</span><span class="p">,</span> <span class="s2">&quot;Alaska&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;LA&quot;</span><span class="p">,</span> <span class="s2">&quot;Louisiana&quot;</span><span class="p">)</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; State</span>
<span class="s2">    city_name : varchar(30)</span>
<span class="s2">    ---</span>
<span class="s2">    capital = null : enum(&quot;YES&quot;)</span>
<span class="s2">    unique index(st, capital)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">City</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>

<span class="n">City</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">City</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Austin&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">))</span>
<span class="n">City</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Houston&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">City</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Olympia&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">City</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">st</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">city_name</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">capital</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>TX</td>
<td>Houston</td>
<td>None</td></tr><tr><td>TX</td>
<td>Austin</td>
<td>YES</td></tr><tr><td>WA</td>
<td>Seattle</td>
<td>None</td></tr><tr><td>WA</td>
<td>Olympia</td>
<td>YES</td> </tr> </tbody>
        </table>
        
        <p>Total: 4</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">State2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    state : char (2)</span>
<span class="s2">    ---</span>
<span class="s2">    state_name : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">City2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; State2</span>
<span class="s2">    city_name : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    
<span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Capital2</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; State2</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; City2</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">State2</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>
<span class="n">City2</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>

<span class="n">State2</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span>
    <span class="p">(</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Washington&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Texas&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;AK&quot;</span><span class="p">,</span> <span class="s2">&quot;Alaska&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;LA&quot;</span><span class="p">,</span> <span class="s2">&quot;Louisiana&quot;</span><span class="p">)</span>
<span class="p">))</span>

<span class="n">City2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">))</span>
<span class="n">City2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Austin&quot;</span><span class="p">))</span>
<span class="n">City2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Houston&quot;</span><span class="p">))</span>
<span class="n">City2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;WA&quot;</span><span class="p">,</span> <span class="s2">&quot;Olympia&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cbefe4c17dad117f2916ab8ce0b45b03c33119ff4de7b30e657d473f688c919c.svg" src="../_images/cbefe4c17dad117f2916ab8ce0b45b03c33119ff4de7b30e657d473f688c919c.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Capital2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Austin&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Capital2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Houston&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">DuplicateError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">Input In [76],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Capital2</span><span class="o">.</span><span class="n">insert1</span><span class="p">((</span><span class="s2">&quot;TX&quot;</span><span class="p">,</span> <span class="s2">&quot;Houston&quot;</span><span class="p">))</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/table.py:334,</span> in <span class="ni">Table.insert1</span><span class="nt">(self, row, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> <span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span><span class="sd">     Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">331</span><span class="sd">     :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span><span class="sd">         as one row.</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">334</span>     <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/benv/lib/python3.10/site-packages/datajoint/table.py:443,</span> in <span class="ni">Table.insert</span><span class="nt">(self, rows, replace, skip_duplicates, ignore_extra_fields, allow_direct_insert)</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span>     <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">440</span>         <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">441</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">442</span> <span class="k">except</span> <span class="n">DuplicateError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">443</span>     <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span>         <span class="s2">&quot;To ignore duplicate entries in insert, set skip_duplicates=True&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span>     <span class="p">)</span>

<span class="ne">DuplicateError</span>: (&quot;Duplicate entry &#39;TX&#39; for key &#39;PRIMARY&#39;&quot;, &#39;To ignore duplicate entries in insert, set skip_duplicates=True&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">City2</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">state</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">city_name</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>TX</td>
<td>Austin</td></tr><tr><td>TX</td>
<td>Houston</td></tr><tr><td>WA</td>
<td>Olympia</td></tr><tr><td>WA</td>
<td>Seattle</td> </tr> </tbody>
        </table>
        
        <p>Total: 4</p></div>
        </div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="in-sql">
<h1>In SQL<a class="headerlink" href="#in-sql" title="Permalink to this heading">#</a></h1>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">state_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">city_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">,</span><span class="w"> </span><span class="n">city_name</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="k">state</span><span class="p">(</span><span class="k">state</span><span class="p">))</span><span class="w"></span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">capital</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">city_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">,</span><span class="w"> </span><span class="n">city_name</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">,</span><span class="w"> </span><span class="n">city_name</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
```sql
CREATE TABLE state (
    state char(2),
    state_name varchar(30),
    capital varchar(30),
    PRIMARY KEY (state),
    FOREIGN KEY (state, capital) REFERENCES city (state, city_name))
    
CREATE TABLE city (
    state char(2),
    city_name varchar(30),
    PRIMARY KEY (state, city_name))
    FOREIGN KEY (state) REFERENCES state(state)
```
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>  Input In [78]
    ```sql
    ^
SyntaxError: invalid syntax
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>In SQL<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">state_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">city_id</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">city_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">is_capital</span><span class="w"> </span><span class="n">enum</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">state_id</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="p">(</span><span class="k">state</span><span class="p">,</span><span class="w"> </span><span class="n">is_capital</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">state</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="k">state</span><span class="p">(</span><span class="k">state</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Permalink to this heading">#</a></h2>
<p>Model a vet clinic.</p>
<ol class="arabic simple">
<li><p>Customers bring in pets. Customers are identified by their cell phones. Pets are identified by their nicknames for that customer.</p></li>
<li><p>Pets have a date of birth, species, and date of birth.</p></li>
<li><p>Pets have a list of vaccinations that must be performed for their species.</p></li>
<li><p>Pets have vaccination administration, shot date.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="s1">&#39;shared_vet&#39;</span><span class="p">)</span>
<span class="n">schema</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="s1">&#39;shared_vet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proceed to delete entire schema `shared_vet`? [yes, No]: yes
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Owner</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    cell_phone : char(10) </span>
<span class="s2">    ---</span>
<span class="s2">    full_name : varchar(16)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Species</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Lookup</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    species : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;cat&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;ferret&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;parrot&#39;</span><span class="p">,))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Species</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">species</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr> <td>cat</td></tr><tr><td>dog</td></tr><tr><td>ferret</td></tr><tr><td>parrot</td> </tr> </tbody>
        </table>
        
        <p>Total: 4</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Pet</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Owner</span>
<span class="s2">    -&gt; Species</span>
<span class="s2">    nickname : varchar(30)</span>
<span class="s2">    ---</span>
<span class="s2">    birthdate : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">RequiredVaccine</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Species</span>
<span class="s2">    vaccine  : varchar(10)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/68b3c7e6f8cac123c01042624e1f93801f24318a28923f81ff0fbe8493e63896.svg" src="../_images/68b3c7e6f8cac123c01042624e1f93801f24318a28923f81ff0fbe8493e63896.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Shot</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Pet</span>
<span class="s2">    -&gt; RequiredVaccine</span>
<span class="s2">    ---</span>
<span class="s2">    shot_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/21780c7802339fe86b8c854a15ab84a4d892d05b8ee82f5038eb60efe5757648.svg" src="../_images/21780c7802339fe86b8c854a15ab84a4d892d05b8ee82f5038eb60efe5757648.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Shot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    <b></b>
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">cell_phone</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">species</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">nickname</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">vaccine</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">shot_date</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">shot</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">cell_phone</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">nickname</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">species</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">vaccine</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">cell_phone</span><span class="p">,</span><span class="w"> </span><span class="n">nickname</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">vaccine</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">cell_phone</span><span class="p">,</span><span class="w"> </span><span class="n">nickname</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w">                         </span><span class="n">pet</span><span class="p">(</span><span class="n">cell_phone</span><span class="p">,</span><span class="w"> </span><span class="n">nickname</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">vaccine</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">required_vaccine</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">vaccine</span><span class="p">)</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="homework-homework">
<h2>Homework homework<a class="headerlink" href="#homework-homework" title="Permalink to this heading">#</a></h2>
<p>Homework assignments, students, grades</p>
<ol class="arabic simple">
<li><p>Homework is given with a due date.</p></li>
<li><p>Students submit homework, we record the submit date</p></li>
<li><p>Submitted homework gets a grade</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Assignment</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    assignment : int</span>
<span class="s2">    ---</span>
<span class="s2">    due_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span> 
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    student_id : int</span>
<span class="s2">    ---</span>
<span class="s2">    student_name : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Submission</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Student</span>
<span class="s2">    -&gt; Assignment</span>
<span class="s2">    ---</span>
<span class="s2">    submit_date : date</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Grade</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Submission</span>
<span class="s2">    ---</span>
<span class="s2">    grade : char(1)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7fed1f6da50e0ebb35abd97f0d2a630a10e3657e860985882b310cd12b2cc3a4.svg" src="../_images/7fed1f6da50e0ebb35abd97f0d2a630a10e3657e860985882b310cd12b2cc3a4.svg" /></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="messaging-app-slack-telegram-signal">
<h1>Messaging App (Slack, Telegram, Signal)<a class="headerlink" href="#messaging-app-slack-telegram-signal" title="Permalink to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>Users can create channels. Each channel belongs to one user.</p></li>
<li><p>Channel names are globally unique</p></li>
<li><p>A user can create a post in their channels only</p></li>
<li><p>A user can be a guest in another persons channel.</p></li>
<li><p>Guest can reply to posts</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    username : varchar(12)</span>
<span class="s2">    ---</span>
<span class="s2">    irl_name : varchar(30)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Channel</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    channel : varchar(12)</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; User</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Guest</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Channel</span>
<span class="s2">    -&gt; User</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f0f47d972ece9b86b995947961fdafbdeb34d9c7b40bf729d0e4a6e8bd677d38.svg" src="../_images/f0f47d972ece9b86b995947961fdafbdeb34d9c7b40bf729d0e4a6e8bd677d38.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Channel</span>
<span class="s2">    post : int</span>
<span class="s2">    ---</span>
<span class="s2">    message : varchar(1024)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Post</span> <span class="o">*</span> <span class="n">Channel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <style type="text/css">
        .Relation{
            border-collapse:collapse;
        }
        .Relation th{
            background: #A0A0A0; color: #ffffff; padding:4px; border:#f0e0e0 1px solid;
            font-weight: normal; font-family: monospace; font-size: 100%;
        }
        .Relation td{
            padding:4px; border:#f0e0e0 1px solid; font-size:100%;
        }
        .Relation tr:nth-child(odd){
            background: #ffffff;
        }
        .Relation tr:nth-child(even){
            background: #f3f1ff;
        }
        /* Tooltip container */
        .djtooltip {
        }
        /* Tooltip text */
        .djtooltip .djtooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }
        #primary {
            font-weight: bold;
            color: black;
        }
        #nonprimary {
            font-weight: normal;
            color: white;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .djtooltip:hover .djtooltiptext {
            visibility: visible;
        }
    </style>
    
    
        <div style="max-height:1000px;max-width:1500px;overflow:auto;">
        <table border="1" class="Relation">
            <thead> <tr style="text-align: right;"> <th> <div class="djtooltip">
                            <p id="primary">channel</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="primary">post</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">message</p>
                            <span class="djtooltiptext"></span>
                        </div></th><th><div class="djtooltip">
                            <p id="nonprimary">username</p>
                            <span class="djtooltiptext"></span>
                        </div> </th> </tr> </thead>
            <tbody> <tr>  </tr> </tbody>
        </table>
        
        <p>Total: 0</p></div>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Response</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Post</span>
<span class="s2">    -&gt; Guest</span>
<span class="s2">    ---</span>
<span class="s2">    response : varchar(1024)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dj</span><span class="o">.</span><span class="n">Diagram</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7b0efa59803c026b33f51a361f41b1aebe5659e1025babba4455639b810e42ea.svg" src="../_images/7b0efa59803c026b33f51a361f41b1aebe5659e1025babba4455639b810e42ea.svg" /></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "benv"
        },
        kernelOptions: {
            name: "benv",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'benv'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Transactions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#design-patterns">Design Patterns</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sequence-workflows">Sequence / Workflows</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#two-ways-to-model-hierarchies">Two ways to model hierarchies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approach-1-simple-primary-keys-with-secondary-dependencies">Approach 1: Simple primary keys with secondary dependencies</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#parameterization">Parameterization</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#association">Association</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#generalization-specialization">Generalization / specialization</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#directed-graphs">Directed graphs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#undirected-graphs">Undirected graphs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#puzzle">Puzzle:</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#in-sql">In SQL</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">In SQL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem">Problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework-homework">Homework homework</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#messaging-app-slack-telegram-signal">Messaging App (Slack, Telegram, Signal)</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dimitri Yatsenko, PhD
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>